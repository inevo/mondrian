<!--
  == $Id$
  == This software is subject to the terms of the Common Public License
  == Agreement, available at the following URL:
  == http://www.opensource.org/licenses/cpl.html.
  == (C) Copyright 2000-2002 Kana Software, Inc. and others.
  == All Rights Reserved.
  == You must accept the terms of that agreement to use this software.
  -->
<Schema>

<!-- Shared dimensions -->

	<Dimension name="Store">
		<Hierarchy hasAll="true" primaryKey="store_id">
			<Table name="store"/>
			<Level name="Store Country" column="store_country" uniqueMembers="true"/>
			<Level name="Store State" column="store_state" uniqueMembers="true"/>
			<Level name="Store City" column="store_city" uniqueMembers="false"/>
			<Level name="Store Name" column="store_name" uniqueMembers="true">
				<Property name="Store Type" column="store_type"/>
				<Property name="Store Manager" column="store_manager"/>
				<Property name="Store Sqft" column="store_sqft" type="Numeric"/>
				<Property name="Grocery Sqft" column="grocery_sqft" type="Numeric"/>
				<Property name="Frozen Sqft" column="frozen_sqft" type="Numeric"/>
				<Property name="Meat Sqft" column="meat_sqft" type="Numeric"/>
				<Property name="Has coffee bar" column="coffee_bar" type="Boolean"/>
				<Property name="Street address" column="store_street_address" type="String"/>
			</Level>
		</Hierarchy>
	</Dimension>

	<Dimension name="Store Size in SQFT">
		<Hierarchy hasAll="true" primaryKey="store_id">
			<Table name="store"/>
			<Level name="Store Sqft" column="store_sqft" type="Numeric" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<Dimension name="Store Type">
		<Hierarchy hasAll="true" primaryKey="store_id">
			<Table name="store"/>
			<Level name="Store Type" column="store_type" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<Dimension name="Time" foreignKey="time_id">
		<Hierarchy hasAll="false" primaryKey="time_id">
			<Table name="time_by_day"/>
			<Level name="Year" column="the_year" type="Numeric" uniqueMembers="true"/>
			<Level name="Quarter" column="quarter" uniqueMembers="false"/>
			<Level name="Month" column="month_of_year" uniqueMembers="false" type="Numeric"/>
		</Hierarchy>
	</Dimension>

	<Dimension name="Product" foreignKey="product_id">
		<Hierarchy hasAll="true" primaryKey="product_id" primaryKeyTable="product">
			<Join leftKey="product_class_id" rightKey="product_class_id">
				<Table name="product"/>
				<Table name="product_class"/>
			</Join>
<!--
			<Query>
				<SQL dialect="generic">
SELECT *
FROM "product", "product_class"
WHERE "product"."product_class_id" = "product_class"."product_class_id"
				</SQL>
			</Query>
			<Level name="Product Family" column="product_family" uniqueMembers="true"/>
			<Level name="Product Department" column="product_department" uniqueMembers="false"/>
			<Level name="Product Category" column="product_category" uniqueMembers="false"/>
			<Level name="Product Subcategory" column="product_subcategory" uniqueMembers="false"/>
			<Level name="Brand Name" column="brand_name" uniqueMembers="false"/>
			<Level name="Product Name" column="product_name" uniqueMembers="true"/>
-->
			<Level name="Product Family" table="product_class" column="product_family" uniqueMembers="true"/>
			<Level name="Product Department" table="product_class" column="product_department" uniqueMembers="false"/>
			<Level name="Product Category" table="product_class" column="product_category" uniqueMembers="false"/>
			<Level name="Product Subcategory" table="product_class" column="product_subcategory" uniqueMembers="false"/>
			<Level name="Brand Name" table="product" column="brand_name" uniqueMembers="false"/>
			<Level name="Product Name" table="product" column="product_name" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<Dimension name="Warehouse">
		<Hierarchy hasAll="true" primaryKey="warehouse_id">
			<Table name="warehouse"/>
			<Level name="Country" column="warehouse_country" uniqueMembers="true"/>
			<Level name="State Province" column="warehouse_state_province" uniqueMembers="true"/>
			<Level name="City" column="warehouse_city" uniqueMembers="false"/>
			<Level name="Warehouse Name" column="warehouse_name" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

<!-- Sales -->
<Cube name="Sales">
	<Table name="sales_fact_1997"/>
	<DimensionUsage name="Store" source="Store" foreignKey="store_id"/>
	<DimensionUsage name="Store Size in SQFT" source="Store Size in SQFT" foreignKey="store_id"/>
	<DimensionUsage name="Store Type" source="Store Type" foreignKey="store_id"/>
	<DimensionUsage name="Time" source="Time" foreignKey="time_id"/>
	<DimensionUsage name="Product" source="Product" foreignKey="product_id"/>
	<Dimension name="Promotion Media" foreignKey="promotion_id">
		<Hierarchy hasAll="true" allMemberName="All Media" primaryKey="promotion_id">
			<Table name="promotion"/>
			<Level name="Media Type" column="media_type" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>
	<Dimension name="Promotions" foreignKey="promotion_id">
		<Hierarchy hasAll="true" allMemberName="All Promotions" primaryKey="promotion_id">
			<Table name="promotion"/>
			<Level name="Promotion Name" column="promotion_name" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>
	<Dimension name="Customers" foreignKey="customer_id">
		<Hierarchy hasAll="true" allMemberName="All Customers" primaryKey="customer_id">
			<Table name="customer"/>
			<Level name="Country" column="country" uniqueMembers="true"/>
			<Level name="State Province" column="state_province" uniqueMembers="true"/>
			<Level name="City" column="city" uniqueMembers="false"/>
			<Level name="Name" ordinalColumn="ordinal" uniqueMembers="true">
				<ExpressionView>
					<SQL dialect="oracle">
"fname" || ' ' || "lname"
					</SQL>
					<SQL dialect="access">
[fname] + ' ' + [lname]
					</SQL>
					<SQL dialect="postgres">
"fname" || ' ' || "lname"
					</SQL>
					<SQL dialect="mysql">
CONCAT(`customer`.`fname`, " ", `customer`.`lname`)
					</SQL>
					<SQL dialect="generic">
"lname"
					</SQL>
				</ExpressionView>
				<Property name="Gender" column="gender"/>
				<Property name="Marital Status" column="marital_status"/>
				<Property name="Education" column="education"/>
				<Property name="Yearly Income" column="yearly_income"/>
			</Level>
		</Hierarchy>
	</Dimension>
	<Dimension name="Education Level" foreignKey="customer_id">
		<Hierarchy hasAll="true" primaryKey="customer_id">
			<Table name="customer"/>
			<Level name="Education Level" column="education" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>
	<Dimension name="Gender" foreignKey="customer_id">
		<Hierarchy hasAll="true" allMemberName="All Gender" primaryKey="customer_id">
			<Table name="customer"/>
			<Level name="Gender" column="gender" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>
	<Dimension name="Marital Status" foreignKey="customer_id">
		<Hierarchy hasAll="true" allMemberName="All Marital Status" primaryKey="customer_id">
			<Table name="customer"/>
			<Level name="Marital Status" column="marital_status" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>
	<Dimension name="Yearly Income" foreignKey="customer_id">
		<Hierarchy hasAll="true" primaryKey="customer_id">
			<Table name="customer"/>
			<Level name="Yearly Income" column="yearly_income" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<Dimension name="Has bought dairy">
		<Hierarchy hasAll="true" memberReaderClass="mondrian.rolap.HasBoughtDairySource">
			<Level name="Has bought dairy" uniqueMembers="true"/>
			<Param name="expression" value="not used"/>
		</Hierarchy>
	</Dimension>
	<Measure name="Unit Sales" column="unit_sales" aggregator="sum" formatString="Standard"/>
	<Measure name="Store Cost" column="store_cost" aggregator="sum" formatString="#,###.00"/>
	<Measure name="Store Sales" column="store_sales" aggregator="sum" formatString="#,###.00"/>
	<Measure name="Sales Count" column="product_id" aggregator="count" formatString="#,###"/>
	<Measure name="Store Sales Net" column="&quot;sales_fact_1997&quot;.&quot;store_sales&quot;-&quot;sales_fact_1997&quot;.&quot;store_cost&quot;" aggregator="sum" formatString="#,###.00"/>
</Cube>

<Cube name="Warehouse">
	<Table name="inventory_fact_1997"/>
	<DimensionUsage name="Store" source="Store" foreignKey="store_id"/>
	<DimensionUsage name="Store Size in SQFT" source="Store Size in SQFT" foreignKey="store_id"/>
	<DimensionUsage name="Store Type" source="Store Type" foreignKey="store_id"/>
	<DimensionUsage name="Time" source="Time" foreignKey="time_id"/>
	<DimensionUsage name="Product" source="Product" foreignKey="product_id"/>
	<DimensionUsage name="Warehouse" source="Warehouse" foreignKey="warehouse_id"/>
	<!-- todo: virtual dimensions -->

	<Measure name="Store Invoice" column="store_invoice" aggregator="sum"/>
	<Measure name="Supply Time" column="supply_time" aggregator="sum"/>
	<Measure name="Warehouse Cost" column="warehouse_cost" aggregator="sum"/>
	<Measure name="Warehouse Sales" column="warehouse_sales" aggregator="sum"/>
	<Measure name="Units Shipped" column="units_shipped" aggregator="sum"/>
	<Measure name="Units Ordered" column="units_ordered" aggregator="sum"/>
	<Measure name="Warehouse Profit" column="&quot;inventory_fact_1997&quot;.&quot;warehouse_sales&quot;-&quot;inventory_fact_1997&quot;.&quot;warehouse_cost&quot;" aggregator="sum"/>
</Cube>

<!-- Test a cube based upon a single table. -->
<Cube name="Store">
	<Table name="store"/>
	<!-- We could have used the shared dimension "Store Type", but we
	     want to test private dimensions without primary key. -->
	<Dimension name="Store Type">
		<Hierarchy hasAll="true">
			<Level name="Store Type" column="store_type" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<!-- We don't have to specify primary key or foreign key since the shared
	     dimension "Store" has the same underlying table as the cube. -->
	<DimensionUsage name="Store" source="Store"/>

	<Dimension name="Has coffee bar">
		<Hierarchy hasAll="true">
			<Level name="Has coffee bar" column="coffee_bar" uniqueMembers="true"/>
		</Hierarchy>
	</Dimension>

	<Measure name="Store Sqft" column="store_sqft" aggregator="sum" formatString="#,###"/>
	<Measure name="Grocery Sqft" column="grocery_sqft" aggregator="sum" formatString="#,###"/>

</Cube>

<VirtualCube name="Warehouse and Sales">
	<VirtualCubeDimension name="Time"/>
	<VirtualCubeDimension name="Store"/>
	<VirtualCubeDimension cubeName="Warehouse" name="Warehouse"/>
	<VirtualCubeMeasure cubeName="Sales" name="[Measures].[Store Sales]"/>
	<VirtualCubeMeasure cubeName="Sales" name="[Measures].[Unit Sales]"/>
	<VirtualCubeMeasure cubeName="Warehouse" name="[Measures].[Units Shipped]"/>
</VirtualCube>

</Schema>
