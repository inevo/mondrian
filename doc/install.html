<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Mondrian installation guide</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" />
</head>

<body bgcolor="#ffffff">

<table border="1" class="clsStd" width="100%">
  <tr>
    <td colspan="2"><a href="index.html">Top</a> |
    <a href="http://66.123.172.226:8080/open/mondrian/doc/install.html">Web</a> |
    <a href="http://sourceforge.net/projects/mondrian/">SourceForge home</a></td>
    <td width="0" align="right" rowspan="2">
    <a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=35302&type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"></a></td>
  </tr>
  <tr>
    <td colspan="2"><em>$Id$</em></td>
  </tr>
  <tr>
    <td colspan="3"><em>(C) Copyright 2002, Kana Software, Inc.</em></td>
  </tr>
  <tr>
    <th align="right" width="30%">Author</th>
    <td colspan="2">Julian Hyde (<a href="mailto:jhyde@users.sourceforge.net">jhyde@users.sourceforge.net</a>)</td>
  </tr>
</table>

<h1><font size="6">How to build and install Mondrian</font></h1>

<h2><a name="1_Contents">1. Contents</a></h2>
<ol>
  <li><a href="#1_Contents">Contents</a>
  <li><a href="#2_Modification_history">Modification history</a>
  <li><a href="#3_Setup_build_environment">Setup build environment</a>
  <li><a href="#4_Download_the_source_code">Download the source code</a><li>
  <a href="#5_Build">Build</a>
  <li><a href="#6_Load_the_database">Load the database</a><li><a href="#5_Run_the_demo">Run the demo</a>
  <li><a href="#8_Run_the_web_app">Run the web app</a>
  <li><a href="#9_Debug_tomcat_using_IntelliJ">Debug tomcat using IntelliJ</a><li>
  <a href="#10_Miscellaneous">Miscellaneous</a>
    <ol>
      <li><a href="#10_1_Coding_guidelines">Coding guidelines</a></li>
    </ol>
  <li><a href="#Appendix_A_Product_installation_instructions">Appendix A: 
  Product instllation instructions</a></li>
</ol>

<h2><a name="2_Modification_history">2. Modification history</a></h2>
<table border="1" class="clsStd" width="100%">
  <tr>
    <th>Date</th>
    <th>Revision</th>
    <th>Author</th>
    <th>Comment</th>
  </tr>
  <tr>
    <td><I>February 7<SUP>th</SUP>, 2002</I></td>
    <td><em>1</em></td>
    <td><i>Julian Hyde</i></td>
    <td><em>Created</em></td>
  </tr>
  <tr>
    <td><I>March 5<SUP>th</SUP>, 2002</I></td>
    <td><em>2</em></td>
    <td><i>Julian Hyde</i></td>
    <td><em>Tomcat install</em></td>
  </tr>
  <tr>
    <td><I>March 28<SUP>th</SUP>, 2002</I></td>
    <td><em>3</em></td>
    <td><i>Julian Hyde</i></td>
    <td><em>Xalan, JUnit and Oracle.<br>
    Moved product info to an appendix.</em></td>
  </tr>
  <tr>
    <td><I>July 26<SUP>th</SUP>, 2002</I></td>
    <td><em>4</em></td>
    <td><i>Julian Hyde</i></td>
    <td><em>Upgrade to Ant 1.5, Tomcat 4.0.4.</em></td>
  </tr>
  
  <tr>
    <td><I>August  01<SUP>st</SUP>, 2002</I></td>
    <td><em>5</em></td>
    <td><i>Julian Hyde</i></td>
    <td><em>Clean up database instructions. Add 'Download the source code' 
    section.</em></td>
  </tr>
  
   <tr>
    <td><I>August 21<SUP>st</SUP>, 2002</I></td>
    <td><em>6</em></td>
    <td><i>Paul Dymecki</i></td>
    <td><em>Add binary installation instructions in 4.1. Add run installation to section 5.
    </em></td>
  </tr>
</table>

<h2><a name="3_Setup_build_environment">3. Setup build environment</a></h2>

<p>Here are the steps to setup a build environment.</p>

<ol>
  <li>Install <a href="#JDK">JDK</a>.</li>
  <li>Install <a href="#Ant">Ant</a>.</li>
  <li>Install <a href="#Tomcat">Tomcat</a>.</li>
  <li>Install <a href="#Xalan">Xalan</a>.</li>
  <li>Install <a href="#JUnit">JUnit</a>.</li>
  <li>Go to <i></i><code><i>${xalan.home}</i>/bin</code>, and copy <code>
  xalan.jar</code> and <code>xml-apis.jar</code> to <i></i><code><i>${tomcat.home}</i>/common/lib</code>.</li>
  <li>Modify <code>build.bat</code>, setting <code>JAVA_HOME</code>, <code>ANT_HOME</code>, 
  <code>TOMCAT_HOME</code>, <code>XALAN_HOME</code>, <code>JUNIT_HOME</code>.</li>
</ol>

<p>Optional:</p>
<ol>
  <li>Install <a href="#Jikes">Jikes</a>.</li>
</ol>

<h2><a name="4_Download_the_source_code">4. Download the source code or the binary</a></h2>

<p>Two ways to do this.</p>

<h3><a name="4_1_Download_the_latest_release_from_SourceForge">4.1. Download the 
latest release from SourceForge</a></h3>
<p>Download <code>mondrian-0.3-src.zip</code> and <code>mondrian-0.3-data.zip</code> 
(or later versions) from <a href="http://sourceforge.net/projects/mondrian">
Sourceforge</a>, and unzip them. For example, if you unzip to <code>Z:\</code>, 
you will end up with a file structure including
<code>Z:\mondrian-0.3\build.xml</code> and
<code>Z:\mondrian-0.3\demo\FoodMartData.sql</code>. Alternatively download the binary
release <code> mondrian-0.3-bin.zip</code> from <a href="http://sourceforge.net/projects/mondrian">
Sourceforge</a>, and unzip.</p>

<h3><a name="4_2_Connect_to_the_Perforce_source_code_server">4.2. Connect to the 
Perforce source code server</a></h3>

<p>If you are a mondrian developer, and need to access the latest source code 
and check in changes, you should connect to the source code server:</p>
<ol>
  <li>Download the perforce client from
  <a href="http://www.perforce.com/perforce/loadprog.html">
  http://www.perforce.com/perforce/loadprog.html</a></li>
  <li>If you have Windows, start the perforce UI (P4Win). (If you are not 
  running windows, you will have to use the command-line interface to do the 
  following; 'p4 help' should get you started.)</li>
  <li>Create a perforce user for yourself (generally people use their 
  SourceForge usernames).</li>
  <li>Create a perforce client (called &lt;&lt;username&gt;&gt; or 
  &lt;&lt;username&gt;&gt;.&lt;&lt;hostname&gt;&gt;), with a root something like 'C:\' or 'D:\work' and 
  view specification of<blockquote>
    <pre>//open/mondrian/... //&lt;&lt;clientname&gt;&gt;/mondrian/...</pre>
  </blockquote>
  </li>
  <li>Sync to head revision.</li>
  <li>Email me the name of the perforce user so I can give you write access to 
  the perforce depot.</li>
</ol>

<h2><a name="5_Build">5. Build</a></h2>
<p>As follows:</p>
<blockquote>
<pre>cd <i>${project.location}</i>
build</pre>
</blockquote>
<p>Or if running from binary release:</p>
<blockquote>
<ol>
<li>cd <i>${project.location}/bin</i> </li>
<li>change variables in mondrian-0.x/bin/junitStart.bat to suit your environment.</li>   
<li>add the mondrian-0.3-bin directory to your systems classpath.</li>   
<li>type startJunit.bat to run the Junit tests.</li>   
<li>To run the webapp copy mondrian.war to Apache_home/webapps.</li>   
<li>Start tomcat and hit http://localhost:8080/mondrian this will not work.</li>   
<li>Stop tomcat.</li>   

<li>Modify web.xml in Apache_home/webapps/mondrian/WEB-INF dir to suit your environment.</li>
<li>Start tomcat and try http://localhost:8080/mondrian again.</li>
 </ol>
</blockquote>
<h2><a name="6_Load_the_database">6. Load the database</a></h2>
<p>You first need a database. How you create and load the database depends upon 
which database you are using.</p>
<p> <i>Did these instructions work for you? Have you managed to get mondrian 
working on other databases/versions? Please let me know.</i></p>
<h3> <b>6.1. Microsoft Access</b></h3>
<p>Download <code><i>${project.location}</i>/demo/access/FoodMart.mdb</code> . 
Start ODBC Administrator, and create a System ODBC DSN called <code>MondrianFoodMart</code> pointing to 
that file.
    The JDBC connect string will be <code>jdbc:odbc:MondrianFoodMart</code>.</p>
<h3>6.2. Oracle</h3>
<p>Version 8.1.7 or higher.</p>
<p>Create the dataset by importing <code>${project.location}/demo/oracle/FoodMart.dmp</code>:<blockquote>

<pre>$ <b>sqlplus system/manager</b>
SQL> <b>create user foodmart identified by foodmart;</b>

User created.

SQL> <b>grant connect, resource to foodmart;</b>

Grant succeeded.

SQL> <b>exit</b>
Disconnected from Oracle8i Enterprise Edition Release 8.1.7.3.0 - Production
With the Partitioning option
JServer Release 8.1.7.3.0 - Production
$ <b>imp foodmart/foodmart full=y file=C:/mondrian/demo/oracle/FoodMart.dmp</b>

Import: Release 8.1.7.3.0 - Production on Mon Aug 5 11:37:35 2002

(c) Copyright 2000 Oracle Corporation.  All rights reserved.


Connected to: Oracle8i Enterprise Edition Release 8.1.7.3.0 - Production
With the Partitioning option
JServer Release 8.1.7.3.0 - Production

Export file created by EXPORT:V08.01.07 via conventional path
import done in WE8ISO8859P1 character set and WE8ISO8859P1 NCHAR character set
. importing FOODMART's objects into FOODMART
. . importing table                     "customer"      10281 rows imported
. . importing table                         "days"          7 rows imported
. . importing table          "inventory_fact_1997"       4070 rows imported
. . importing table          "inventory_fact_1998"       7282 rows imported
. . importing table                      "product"       1560 rows imported
. . importing table                "product_class"        110 rows imported
. . importing table                    "promotion"       1864 rows imported
. . importing table                       "region"        110 rows imported
. . importing table              "sales_fact_1997"      86837 rows imported
. . importing table              "sales_fact_1998"     164558 rows imported
. . importing table          "sales_fact_dec_1998"      18325 rows imported
. . importing table                        "store"         24 rows imported
. . importing table                  "time_by_day"        730 rows imported
. . importing table                    "warehouse"         24 rows imported
. . importing table              "warehouse_class"          6 rows imported
Import terminated successfully without warnings.</pre>
</blockquote>. (You don't need to run <code>FoodMartTables.sql</code> and <code>
FoodMartIndexes.sql</code> in that folder.)</p>
<p>Setup your environment as follows:</p>
<ol>
  <li>Set <code>ORACLE_HOME</code> in <code>build.bat</code>, or in your 
  environment.</li>
  <li>Append <code>%ORACLE_HOME%/jdbc/lib/classes12.zip</code> to <code>
  CLASSPATH</code> in <code>build.bat</code>, or in your environment.</li>
  <li>In <code>build.xml</code>, make sure that the property <code>
  mondrian.jdbcDrivers</code> includes <code>oracle.jdbc.OracleDriver</code>.</li>
  <li>In <code>build.xml</code>, set the property <code>
  mondrian.foodmart.jdbcURL</code>. It should probably include a username and 
  password, for example <code>
  <a href="mailto:jdbc:oracle:oci8:foodmart/foodmart@myoracle">jdbc:oracle:oci8:foodmart/foodmart@myoracle</a></code>.</li>
      <li>In <code>FoodMart.xml</code>, change the query for customers to <code>SELECT 
      *, &quot;fname&quot; || ' ' || &quot;lname&quot; as &quot;name&quot; FROM &quot;customer&quot;</code>, 
      because the concatenation operator is '||' and not '+'.</li>
</ol>
  <h3><a name="6_3_hsqldb">6.3. Hypersonic SQL (hsqldb)</a></h3>
<p>Create and populate the schema  by running the scripts <code>FoodMartTables.sql</code>,
    <code>FoodMartData.sql</code> and <code>FoodMartIndexes.sql</code> in <code>${project.location}/demo/</code>.</p>
<h3>6.4. mySQL</h3>
<p>As <a href="#6_3_hsqldb">hsqldb</a>, except for the following.</p>
<p>Change all <code>varchar</code> 
        columns in <code>FoodMartTables.sql</code> to
        <code>varchar(30)</code>,&nbsp;and change all
        <code>false</code>/<code>true</code> values in <code>
        FoodMartData.sql</code> to <code>0</code>/<code>1</code>.</p>
<p>In build.xml, set the property <code>
  mondrian.foodmart.jdbcURL</code>. A typical value is <code>
jdbc:mysql://localhost/foodmart?user=root&amp;password=</code>, but because the 
value is in an xml file, you will have to escape the '&amp;' as '&amp;#38;', for 
example:</p><blockquote>

<pre>&lt;property name=&quot;mondrian.foodmart.jdbcURL&quot;
    value=&quot;jdbc:mysql://localhost/foodmart?user=root&amp;#38;password=&quot;/&gt;</pre>
    
</blockquote>
<h3>6.5. Postgres</h3>
<p>As <a href="#6_3_hsqldb">hsqldb</a>, except for the following.</p>
<p>In <code>
        FoodMartTables.sql</code>, change <code>DOUBLE</code> to <code>DOUBLE
    PRECISION</code>, and <code>BIT</code> to <code>SMALLINT</code>.</p>
In <code>FoodMart.xml</code>, change the query for customers to <code>SELECT 
      *, &quot;fname&quot; || ' ' || &quot;lname&quot; as &quot;name&quot; FROM &quot;customer&quot;</code>, 
because the concatenation operator is '||' and not '+'.<h2>
<a name="7_Run_the_test_suite">7. Run the test suite</a></h2>
<p>Edit the &quot;FoodMartTest&quot; target in <code>build.xml</code>.</p>
<p>Run</p>
<blockquote>
  <pre>cd <i>${project.location}</i>
build test</pre>
</blockquote>
<h2><a name="8_Run_the_web_app">8. Run the web app</a></h2>
<ol>
  <li>First install Tomcat, as above.</li>
  <li>Make sure the <code>web.xml</code> file in <code>${project.location}/</code><code>webapp/WEB-INF</code> 
  is correct for your environment. In particular, check the paths in the init 
  parameters to <code>MDXQueryServlet</code>.</li>
  <li><code>build deploy-webapp</code>.</li>
  <li>Start up tomcat. (<code>build start.tomcat</code> is an easy way to do this.)</li>
  <li>Hit <a href="http://localhost:8080/mondrian" target="_new">http://localhost:8080/mondrian</a>.</li>
</ol>
<h2><a name="9_Debug_tomcat_using_IntelliJ">9. Debug tomcat using IntelliJ</a></h2>
<ol>
  <li>add <code><i>${tomcat.home}</i>/webapps/mondrian.war</code> to intellij's 
  classpath</li>
  <li>edit <code><i>${tomcat.home}</i>/bin/catalina.bat</code> as follows:
  <blockquote>
<pre><code>:doJpda
if not &quot;%SECURITY_POLICY_FILE%&quot; == &quot;&quot; goto doSecurityJpda
%_EXECJAVA% %JAVA_OPTS% %CATALINA_OPTS% -Xdebug <font color="#FF0000"><i><b>-Xnoagent
 </b></i></font> -Xrunjdwp:transport=<font color="#FF0000"><i><b>dt_socket</b></i></font>,address=%JPDA_ADDRESS%,server=y,suspend=n %DEBUG_OPTS%
  -Djava.endorsed.dirs=&quot;%JAVA_ENDORSED_DIRS%&quot; -classpath &quot;%CLASSPATH%&quot;
  -Dcatalina.base=&quot;%CATALINA_BASE%&quot; -Dcatalina.home=&quot;%CATALINA_HOME%&quot;
  -Djava.io.tmpdir=&quot;%CATALINA_TMPDIR%&quot; %MAINCLASS% %CMD_LINE_ARGS% %ACTION%
goto end</code></pre>
  </blockquote>
  </li>
  <li>create <code><i>${tomcat.home}</i>/bin/setenv.bat</code> as follows:
  <blockquote>
<pre><code>set JPDA_ADDRESS=5000</code></pre>
  </blockquote>
  </li>
  <li><code>cd e:\jakarta-tomcat-4.0.3\bin</code></li>
  <li><code>catalina jpda run</code></li>
  <li>attach intellij's debugger to port 5000</li>
</ol>
<h2><a name="10_Miscellaneous">10. Miscellaneous</a></h2>
<h3><a name="10_1_Coding_guidelines">10.1. Coding guidelines</a></h3>
<ul>
  <li>Indentation 4.</li>
  <li>Tab stop 4.</li>
  <li>Use tabs, not space.</li>
  <li>K&R bracing
convention (that is, open braces on the same line as the preceding 'if', 'else', 'while' statement or 'class' declaration).</li>
  <li>Use braces even for single-line blocks.</li>
  <li>Declare variables as near to
their first use as possible.</li>
  <li>Don't initialize variables with 'dummy' values just
to shut up the compiler.</li>
  <li>Try to keep lines shorter than 80 characters.</li>
  <li>Javadoc comments on
methods are written in the active ('Collects garbage.') not imperative ('Collect
garbage.')</li>
  <li>When editing HTML documents, don't use an editor which reformats the
HTML source (such as Word).</li>
</ul>

<h2><a name="Appendix_A_Product_installation_instructions">Appendix A. Product 
installation instructions</a></h2>

<p>These are the products I used to build mondrian. Install all of the products
marked 'required'. (I use <code>/</code>-es in paths because I am run MKS on
Windows 2000, and it makes things simpler.)</p>

<p>In the following, the symbol <code><i>${project.location}</i></code> means the root of your
source tree.</p>

<p>Where the instructions suggest setting an environment variable, it is often 
sufficient to edit the corresponding line in <code><i>${project.location}</i>/build.bat</code>.</p>

<table border="1" class="clsStd" width="100%">
  <tr>
    <th>Product</th>
    <th>Required?</th>
    <th>Version</th>
    <th>Comment</th>
  </tr>
  <tr>
    <td><a name="JDK">JDK</a></td>
    <td>Yes</td>
    <td>1.1 or later (I use version 1.3.1.)</td>
    <td>Available from <a href="http://developer.java.sun.com/" target="_blank">http://developer.java.sun.com/</a>.
      I downloaded <code>j2sdk-1_3_1_02-win.exe</code>, and extracted to <code>E:/jdk1.3.1_02</code>. Set
      <code> JAVA_HOME</code> to same, and <code> CLASS_PATH</code> to <code>%JAVA_HOME%/lib/dt.jar</code>.</td>
  </tr>
  <tr>
    <td><a name="Ant">Ant</a></td>
    <td>Yes</td>
    <td>1.5 or later&nbsp;</td>
    <td>I downloaded
<a href="http://jakarta.apache.org/builds/jakarta-ant/release/v1.5/bin/jakarta-ant-1.5-bin.zip">
jakarta-ant-1.5-bin.zip</a>,  extracted to <code>E:/jakarta-ant-1.5</code>, 
    and set <code>ANT_HOME</code> to the same.</td>
  </tr>
  <tr>
    <td><a name="Tomcat">Tomcat</a></td>
    <td>Yes</td>
    <td>4.0 or later (I use version 4.0.4)</td>
    <td>Available from <a href="http://jakarta.apache.org/tomcat" target="_blank">
    http://jakarta.apache.org/tomcat</a>. I downloaded <code>
    jakarta-tomcat-4.0.4.zip</code>,  extracted to <code>E:/jakarta-tomcat-4.0.4</code>, 
    and set <font face="Verdana"><code>TOMCAT_HOME</code></font> to the same.</td>
  </tr>
  <tr>
    <td><a name="Jikes">Jikes</a></td>
    <td>No</td>
    <td>&nbsp;</td>
    <td>Available from <a href="http://oss.software.ibm.com/developerworks/opensource/jikes/" target="_blank">http://oss.software.ibm.com/developerworks/opensource/jikes/</a>.
      I <code>downloaded jikes-1.15-windows.zip</code>, and extracted <code>jikes.exe</code>
      to <code>C:/winnt/system32</code>. Then uncomment the relevant lines of <code><i>${project.location}</i>/build.properties</code>.</td>
  </tr>
  <tr>
    <td><a name="Xerces">Xerces</a></td>
    <td>&nbsp;</td>
    <td>1.4.1 or later</td>
    <td><code>xerces.jar</code> is included with Tomcat.</td>
  </tr>
  <tr>
    <td><a name="Xalan">Xalan</a></td>
    <td>Yes</td>
    <td>2.3.1 or later</td>
    <td>Available from <a href="http://xml.apache.org/xalan-j/" target="_blank">
    http://xml.apache.org/xalan-j/</a>. I downloaded <code>xalan-j_2_3_1-bin.zip</code>, 
    extracted to <code>E:/xalan-j_2_3_1</code>, and set <code>XALAN_HOME</code> 
    to the same.</td>
  </tr>
  <tr>
    <td><a name="JUnit">JUnit</a></td>
    <td>Yes</td>
    <td>3.7 or later</td>
    <td>Available from <a href="http://www.junit.org/">http://www.junit.org/</a>. I downloaded <code>
    junit3.7.zip</code>, 
    extracted to <code>E:/junit3.7</code>, and set <code>JUNIT_HOME</code> 
    to the same.</td>
  </tr>
  <tr>
    <td>Intellij IDEA (a Java IDE)</td>
    <td>No</td>
    <td>2.5.1</td>
    <td>You can download a 30-day evaluation copy from <a href="http://www.intellij.com/idea/" target="_blank">http://www.intellij.com/idea/</a>.
      Follow the instructions in <code>Install.txt</code> in <code>idea-2_5_1.zip</code>
      to there.
      <p>Create a project <code><i>${project.location}</i>/mondrian.ipr</code>.
      Set the compiler output path to <code><i>${project.location}</i>/classes/</code>.
      Add <code>javacup.jar</code> and <code>xerces.jar</code>
      in <code><i>${project.location}</i>/lib/</code> to the class
      path.</p>
      <p>To use Ant build, click the '6: Ant Build' tab, click '+', choose <code><i>${project.location}</i>/build.xml</code>, then right-click, choose
      'Properties', and choose 'Include project classpath'. (<code>javacup.jar</code> 
      is needed in order to build the <code>parser</code> target.)</td>
  </tr>
  <tr>
    <td>hsql Database Engine</td>
    <td>No</td>
    <td>1.61</td>
    <td>
<p>Available from <a href="http://hsqldb.sourceforge.net/" target="_blank">http://hsqldb.sourceforge.net/</a>.
I extracted <code>hsqldb_v.1.61.zip</code> to <code>E:/hsqldb_v.1.61</code>,
then edited <code>bin/run.bat</code>. You will need to add <code>hsqldb.jar</code> 
to your classpath.</p>
    </td>
  </tr>
  <tr>
    <td>mySQL</td>
    <td>No</td>
    <td>?</td>
    <td>
?</td>
  </tr>
  <tr>
    <td>Postgres</td>
    <td>No</td>
    <td>?</td>
    <td>
?</td>
  </tr>
  <tr>
    <td>JavaCUP (parser generator)</td>
    <td>Included with source distribution, as <code>lib/javacup.jar</code>.&nbsp;</td>
    <td>v0.10g (with modifications)</td>
    <td>Available from <a href="http://www.cs.princeton.edu/~appel/modern/java/CUP/" target="_blank">http://www.cs.princeton.edu/~appel/modern/java/CUP/</a>.
      I modified version v.0.10g to add an Ant task, and to output error
      messages in a format which Emacs can parse.</td>
  </tr>
  </table>

<p>&nbsp;</p>

<b>
  <table border="1" width="100%" class="clsStd">
    <tr>
      <td>End <i>$Id$</i></td>
    </tr>
  </table>
  <p>&nbsp;&nbsp;&nbsp; </p>
</b>

</body>

</html>